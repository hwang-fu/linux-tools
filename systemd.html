<!-- * * * * * * * * * * * * * * -->
<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <title>systemd</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs/plugins/line-numbers/prism-line-numbers.min.css">

    <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/autoloader/prism-autoloader.min.js"
            data-prismjs-autoloader-path="https://cdn.jsdelivr.net/npm/prismjs/components/"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs/plugins/line-numbers/prism-line-numbers.min.js"></script>

<style>
    html {
        scroll-behavior: smooth;
    }

    .back-to-top {
        position: fixed;
        right: 20px;
        bottom: 20px;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: #333;
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        text-decoration: none;
        font-size: 22px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        opacity: 0.75;
        transition: opacity 0.2s ease, transform 0.2s ease;
        z-index: 999;
    }

    .back-to-top:hover {
        opacity: 1;
        transform: translateY(-2px);
    }

    .nav-icon {
        width: 18px;
        height: 18px;
        object-fit: contain;
        vertical-align: middle;
        margin-left: 0.3rem;
    }

    table {
        border-collapse: collapse;
        width: 100%;
        font-family: "KaiTi", "楷体", "STKaiti", "Kaiti SC", serif;
        font-size: 14px;
    }

    th {
        background-color: #f5f5f5;
        text-align: left;
        font-weight: 600;
    }

    th, td {
        border: 1px solid #ddd;
        padding: 8px 12px;
    }

    tr:nth-child(even) {
        background-color: #fafafa;
    }

    tr:hover {
        background-color: #f0f8ff;
    }

    .comment {
        color: grey;
    }

    .token.keyword {
        font-weight: 500;
    }

    .red-underline {
        text-decoration-line: underline;
        text-decoration-color: red;
        text-decoration-thickness: 2px;
        text-underline-offset: 2px;
    }

    body {
        font-family: "KaiTi", "楷体", "STKaiti", "Kaiti SC", serif;
        font-variant-ligatures: none;
    }

    ul > li {
        list-style-type: disc;
    }

    code {
        color: #24292e;
        background-color: #f6f8fa;
        border: 1px solid #d0d7de;
        border-radius: .375rem;
        padding: .15rem .35rem;
        font-family: "FiraCode Nerd Font", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
        font-size: 0.875rem;
        line-height: 1.4;
    }


    pre {
        margin: 1rem 0;
        padding: .8rem 1rem;
        background-color: #f6f8fa;
        border: 1px solid #d0d7de;
        border-radius: .5rem;
        overflow: auto;
        tab-size: 4;
    }


    pre code {
        display: block;
        padding: 0;
        background: transparent;
        border: 0;
        color: #24292e;
        font-family: "FiraCode Nerd Font", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
        font-size: 0.875rem;
        line-height: 1.5;
        white-space: pre;
    }
</style>
</head>
<!-- * * * * * * * * * * * * * * -->
<body>
<a href="#" class="back-to-top" aria-label="Back to top">
    &#8593;
</a>
<!-- * * * * * * * * * * * * * * -->


<!-- * * * * * * * * * * * * * * -->
<hr/>
<nav id="toc" style="margin-bottom: 2rem;">
    <ul style="line-height: 1.8;">
        <li><a href="#systemd-intro">Introduction</a></li>
        <li><a href="#systemd-info">Viewing Information in systemd</a></li>
        <li><a href="#systemd-services">Working with Services</a></li>
        <li><a href="#systemd-changing-states">Changing System States</a></li>
    </ul>
</nav>
<hr/>
<!-- * * * * * * * * * * * * * * -->


<!-- * * * * * * * * * * * * * * -->
<h3 id="systemd-intro">Introduction to <code>systemd</code></h3>
<ol>

    <li><b>What Is systemd?</b></li>
    <ul>
        <br/>
        <li><code>systemd</code> is the modern <b>init system</b> used by most Linux distributions (Fedora, Ubuntu, Debian, openSUSE, Arch, etc.).</li>
        <br/>
        <li>It is the first process started at boot (PID 1) and is responsible for:
            <ul>
                <li>booting and shutting down the system,</li>
                <li>starting services,</li>
                <li>managing daemons,</li>
                <li>handling logs and timers.</li>
            </ul>
        </li>
        <br/>
        <li>It replaces the older SysV init (<code>/etc/init.d/*</code>) with a faster and more reliable parallel boot model.</li>
    </ul>
    <br/><br/>


    <li><b>Systemd’s Core Concepts</b></li>
    <br/>
    <ul>
        <li><b>Units</b>: the building blocks systemd manages. Types include:
            <ul>
                <li><code>.service</code> — background daemons</li>
                <li><code>.timer</code> — scheduled tasks</li>
                <li><code>.target</code> — logical groups (similar to runlevels)</li>
                <li><code>.mount</code> — mount points</li>
                <li><code>.socket</code> — socket activation units</li>
            </ul>
        </li>
        <br/>
        <li><b>Systemctl</b>: the command-line tool you use to interact with systemd.</li>
    </ul>
    <br/><br/>


    <li><b>Most Common systemctl Commands</b></li>
    <br/>
    <ul>
        <li>Start / Stop / Restart a service:</li>
    </ul>

<pre><code class="language-bash line-numbers">sudo systemctl start nginx
sudo systemctl stop nginx
sudo systemctl restart nginx
</code></pre>

    <ul>
        <li>Enable or disable at boot:</li>
    </ul>

<pre><code class="language-bash line-numbers">sudo systemctl enable nginx
sudo systemctl disable nginx
</code></pre>

    <ul>
        <li>Check service status:</li>
    </ul>

<pre><code class="language-bash line-numbers">systemctl status nginx
</code></pre>

    <ul>
        <li>View logs (via systemd-journald):</li>
    </ul>

<pre><code class="language-bash line-numbers">journalctl -u nginx
</code></pre>

    <br/><br/>


    <li><b>A Minimal systemd Service Example</b></li>
    <br/>
    <ul>
        <li>Create a file: <code>/etc/systemd/system/myapp.service</code></li>
    </ul>

<pre><code class="language-plaintext line-numbers">[Unit]
Description=My Sample App

[Service]
ExecStart=/usr/bin/python3 /opt/myapp/app.py
Restart=always

[Install]
WantedBy=multi-user.target
</code></pre>

    <ul>
        <li>Activate it:</li>
    </ul>

<pre><code class="language-bash line-numbers">sudo systemctl daemon-reload
sudo systemctl start myapp
sudo systemctl enable myapp
</code></pre>

    <br/><br/>
</ol>
<!-- * * * * * * * * * * * * * * -->


<hr/>


<!-- * * * * * * * * * * * * * * -->
<h3 id="systemd-info">Viewing Information in <code>systemd</code></h3>
<ol>

    <li><b>Overview</b></li>
    <br/>
    <ul>
        <li><code>systemd</code> provides powerful tools to inspect:
            <ul>
                <li>service status,</li>
                <li>logs,</li>
                <li>unit dependencies,</li>
                <li>boot performance,</li>
                <li>failed units,</li>
                <li>target states.</li>
            </ul>
        </li>
    </ul>
    <br/><br/>


    <li><b>Check the Status of a Service</b></li>
    <br/>
    <ul>
        <li>The most common command:</li>
    </ul>

<pre><code class="language-bash line-numbers">systemctl status nginx
</code></pre>

    <ul>
        <li>Shows:
            <ul>
                <li>active/inactive status,</li>
                <li>PID, memory, uptime,</li>
                <li>recent log lines,</li>
                <li>unit file path.</li>
            </ul>
        </li>
    </ul>

    <br/><br/>


    <li><b>List All Units</b></li>
    <br/>
    <ul>
        <li>Show every unit systemd knows about:</li>
    </ul>

<pre><code class="language-bash line-numbers">systemctl list-units
</code></pre>

    <ul>
        <li>Show <u>all</u> units including inactive ones:</li>
    </ul>

<pre><code class="language-bash line-numbers">systemctl list-units --all
</code></pre>

    <br/><br/>


    <li><b>List All Services Only</b></li>
    <br/>
    <ul>
        <li>Filter only <code>.service</code> units:</li>
    </ul>

<pre><code class="language-bash line-numbers">systemctl list-units --type=service
</code></pre>

    <ul>
        <li>You can also list:
            <ul>
                <li><code>--type=socket</code></li>
                <li><code>--type=timer</code></li>
                <li><code>--type=mount</code></li>
                <li><code>--type=target</code></li>
            </ul>
        </li>
    </ul>

    <br/><br/>


    <li><b>List Failed Units</b></li>
    <br/>
    <ul>
        <li>To quickly see what crashed:</li>
    </ul>

<pre><code class="language-bash line-numbers">systemctl --failed
</code></pre>

    <ul>
        <li>Useful after boot or troubleshooting.</li>
    </ul>
    <br/><br/>


    <li><b>View Logs of a Service</b></li>
    <br/>
    <ul>
        <li>Using the journal:</li>
    </ul>

<pre><code class="language-bash line-numbers">journalctl -u nginx
</code></pre>

    <ul>
        <li>Follow logs live (similar to <code>tail -f</code>):</li>
    </ul>

<pre><code class="language-bash line-numbers">journalctl -u nginx -f
</code></pre>

    <ul>
        <li>View today’s logs:</li>
    </ul>

<pre><code class="language-bash line-numbers">journalctl -u nginx --since today
</code></pre>

    <ul>
        <li>View logs since last boot:</li>
    </ul>

<pre><code class="language-bash line-numbers">journalctl -u nginx -b
</code></pre>

    <br/><br/>


    <li><b>View System-Wide Logs</b></li>
    <br/>
    <ul>
        <li>All logs managed by <code>systemd-journald</code>:</li>
    </ul>

<pre><code class="language-bash line-numbers">journalctl
</code></pre>

    <ul>
        <li>Filter by priority:</li>
    </ul>

<pre><code class="language-bash line-numbers">journalctl -p warning
journalctl -p err
journalctl -p crit
</code></pre>

    <ul>
        <li>Filter by time:</li>
    </ul>

<pre><code class="language-bash line-numbers">journalctl --since "2024-01-01" --until "2024-01-02"
</code></pre>

    <br/><br/>


    <li><b>Inspect Unit Configuration Files</b></li>
    <br/>
    <ul>
        <li>See the exact unit file systemd is using:</li>
    </ul>

<pre><code class="language-bash line-numbers">systemctl cat nginx.service
</code></pre>

    <ul>
        <li>List all property fields of a unit:</li>
    </ul>

<pre><code class="language-bash line-numbers">systemctl show nginx
</code></pre>

    <ul>
        <li>This reveals:
            <ul>
                <li>Runtime paths</li>
                <li>CGroup config</li>
                <li>Environment variables</li>
                <li>Restart settings</li>
                <li>Unit metadata</li>
            </ul>
        </li>
    </ul>

    <br/><br/>


    <li><b>View Dependencies and Boot Order</b></li>
    <br/>
    <ul>
        <li>To understand dependencies around a service:</li>
    </ul>

<pre><code class="language-bash line-numbers">systemctl list-dependencies sshd
</code></pre>

    <ul>
        <li>Display reverse dependencies (what depends on this unit):</li>
    </ul>

<pre><code class="language-bash line-numbers">systemctl list-dependencies --reverse sshd
</code></pre>

    <ul>
        <li>Graphical view (ASCII tree):</li>
    </ul>

<pre><code class="language-bash line-numbers">systemctl list-dependencies --all
</code></pre>

    <br/><br/>


    <li><b>Check Boot Time and Performance</b></li>
    <br/>
    <ul>
        <li>Use <code>systemd-analyze</code> to inspect boot performance:</li>
    </ul>

<pre><code class="language-bash line-numbers">systemd-analyze
</code></pre>

    <ul>
        <li>See slowest services:</li>
    </ul>

<pre><code class="language-bash line-numbers">systemd-analyze blame
</code></pre>

    <ul>
        <li>View dependency graph (export as image):</li>
    </ul>

<pre><code class="language-bash line-numbers">systemd-analyze plot &gt; boot.svg
</code></pre>

    <br/><br/>


    <li><b>Check Current System Target (Runlevel)</b></li>
    <br/>
    <ul>
        <li>To see what systemd target (similar to old runlevel) is active:</li>
    </ul>

<pre><code class="language-bash line-numbers">systemctl get-default
</code></pre>

    <ul>
        <li>Examples:
            <ul>
                <li><code>graphical.target</code></li>
                <li><code>multi-user.target</code></li>
            </ul>
        </li>
    </ul>

    <br/><br/>
</ol>
<!-- * * * * * * * * * * * * * * -->


<hr/>


<!-- * * * * * * * * * * * * * * -->
<h3 id="systemd-services">Working with Services in <code>systemd</code></h3>
<ol>

    <li><b>Overview</b></li>
    <br/>
    <ul>
        <li>Services in <code>systemd</code> are defined by <code>.service</code> unit files.</li>
        <li>They represent background processes or daemons such as:
            <ul>
                <li>sshd</li>
                <li>nginx</li>
                <li>docker</li>
                <li>cron</li>
                <li>your own apps</li>
            </ul>
        </li>
        <li>This chapter focuses on how to <b>start</b>, <b>stop</b>, <b>enable</b>, <b>restart</b>, and <b>inspect</b> systemd services.</li>
    </ul>
    <br/><br/>


    <li><b>Starting and Stopping Services</b></li>
    <br/>
    <ul>
        <li>To immediately start a service:</li>
    </ul>

<pre><code class="language-bash line-numbers">sudo systemctl start nginx
</code></pre>

    <ul>
        <li>To stop a running service:</li>
    </ul>

<pre><code class="language-bash line-numbers">sudo systemctl stop nginx
</code></pre>

    <ul>
        <li>Restart a service (loads new config):</li>
    </ul>

<pre><code class="language-bash line-numbers">sudo systemctl restart nginx
</code></pre>

    <ul>
        <li>Reload configuration without restarting the entire service:</li>
    </ul>

<pre><code class="language-bash line-numbers">sudo systemctl reload nginx
</code></pre>

    <br/><br/>


    <li><b>Enabling and Disabling Services at Boot</b></li>
    <br/>
    <ul>
        <li>Enable a service so it starts automatically at boot:</li>
    </ul>

<pre><code class="language-bash line-numbers">sudo systemctl enable nginx
</code></pre>

    <ul>
        <li>Disable it:</li>
    </ul>

<pre><code class="language-bash line-numbers">sudo systemctl disable nginx
</code></pre>

    <ul>
        <li>Check if a service is enabled:</li>
    </ul>

<pre><code class="language-bash line-numbers">systemctl is-enabled nginx
</code></pre>

    <br/><br/>


    <li><b>Checking Service Status</b></li>
    <br/>
    <ul>
        <li>Basic status:</li>
    </ul>

<pre><code class="language-bash line-numbers">systemctl status nginx
</code></pre>

    <ul>
        <li>Displays:
            <ul>
                <li>active / inactive / failed state</li>
                <li>process ID, CPU, memory</li>
                <li>recent logs</li>
                <li>unit file info</li>
            </ul>
        </li>
    </ul>

    <br/><br/>


    <li><b>Viewing Logs of a Service</b></li>
    <br/>
    <ul>
        <li>Logs are collected by <code>systemd-journald</code> and viewed via <code>journalctl</code>:</li>
    </ul>

<pre><code class="language-bash line-numbers">journalctl -u nginx
</code></pre>

    <ul>
        <li>Follow logs in real time:</li>
    </ul>

<pre><code class="language-bash line-numbers">journalctl -u nginx -f
</code></pre>

    <ul>
        <li>Show only current boot:</li>
    </ul>

<pre><code class="language-bash line-numbers">journalctl -u nginx -b
</code></pre>

    <br/><br/>


    <li><b>Reloading systemd After Creating or Editing Unit Files</b></li>
    <br/>
    <ul>
        <li>After editing files in <code>/etc/systemd/system/</code> or creating new services, you must reload systemd:</li>
    </ul>

<pre><code class="language-bash line-numbers">sudo systemctl daemon-reload
</code></pre>

    <ul>
        <li>This updates systemd’s internal unit registry.</li>
    </ul>

    <ul>
        <li>Then restart or start the updated service:</li>
    </ul>

<pre><code class="language-bash line-numbers">sudo systemctl restart myapp.service
</code></pre>

    <br/><br/>


    <li><b>Masking and Unmasking Services</b></li>
    <br/>
    <ul>
        <li>Mask a service to prevent it from starting <u>even manually</u>:</li>
    </ul>

<pre><code class="language-bash line-numbers">sudo systemctl mask nginx
</code></pre>

    <ul>
        <li>Unmask it:</li>
    </ul>

<pre><code class="language-bash line-numbers">sudo systemctl unmask nginx
</code></pre>

    <ul>
        <li>This is stronger than <code>disable</code> and is used to stop dangerous or conflicting services.</li>
    </ul>

    <br/><br/>


    <li><b>Viewing All Services</b></li>
    <br/>
    <ul>
        <li>List only services (not timers, sockets, etc.):</li>
    </ul>

<pre><code class="language-bash line-numbers">systemctl list-units --type=service
</code></pre>

    <br/>
    <ul>
        <li>Show services including inactive ones:</li>
    </ul>

<pre><code class="language-bash line-numbers">systemctl list-unit-files --type=service
</code></pre>

    <ul>
        <li>This shows installed service files regardless of running state.</li>
    </ul>

    <br/><br/>


    <li><b>Autorestart and Service Recovery</b></li>
    <br/>
    <ul>
        <li>Services can be configured to restart automatically on crash.</li>
        <li>Inside a <code>.service</code> file:</li>
    </ul>

<pre><code class="language-plaintext line-numbers">[Service]
Restart=on-failure
RestartSec=5
</code></pre>

    <ul>
        <li>Useful for long-running daemons or servers.</li>
    </ul>

    <br/><br/>


    <li><b>Environments and Working Directory</b></li>
    <br/>
    <ul>
        <li>You can set environment variables:</li>
    </ul>

<pre><code class="language-plaintext line-numbers">[Service]
Environment="APP_ENV=production"
WorkingDirectory=/opt/myapp
ExecStart=/usr/bin/python3 app.py
</code></pre>

    <ul>
        <li>Or load them from a file:</li>
    </ul>

<pre><code class="language-plaintext line-numbers">EnvironmentFile=/etc/myapp/env.conf
</code></pre>

    <ul>
        <li>This is commonly used for secrets and configs.</li>
    </ul>

    <br/><br/>
</ol>
<!-- * * * * * * * * * * * * * * -->


<hr/>


<!-- * * * * * * * * * * * * * * -->
<h3 id="systemd-changing-states">Changing System States in <code>systemd</code></h3>
<ol>

    <li><b>Overview</b></li>
    <ul>
        <br/>
        <li><code>systemd</code> manages the entire system state using <b>targets</b>.</li>
        <br/>
        <li>Targets replace the old SysV “runlevels”.</li>
        <br/>
        <li>Each target represents a specific operating mode such as:
            <ul>
                <li>graphical UI</li>
                <li>multi-user server mode</li>
                <li>rescue mode</li>
                <li>shutdown / reboot</li>
            </ul>
        </li>
    </ul>
    <br/><br/>


    <li><b>Common systemd Targets</b></li>
    <br/>
    <ul>
        <li>The most frequently used systemd targets:</li>
    </ul>

<pre><code class="language-plaintext line-numbers">poweroff.target      → Shut down the system
reboot.target        → Restart the system
multi-user.target    → Multi-user text mode (server mode)
graphical.target     → GUI login mode
rescue.target        → Single-user maintenance mode
emergency.target     → Very minimal recovery shell
default.target       → The system’s default boot mode
</code></pre>

    <ul>
        <li>These targets group services together to define what runs in each state.</li>
    </ul>
    <br/><br/>


    <li><b>Check the Current System State</b></li>
    <br/>
    <ul>
        <li>To see what the system boots into by default:</li>
    </ul>

<pre><code class="language-bash line-numbers">systemctl get-default
</code></pre>

    <ul>
        <li>Example outputs:</li>
    </ul>

<pre><code class="language-plaintext line-numbers">graphical.target
multi-user.target
</code></pre>

    <br/><br/>


    <li><b>Switching System States (Temporarily)</b></li>
    <br/>
    <ul>
        <li>You can change the current target without altering the boot default.</li>
        <li>Switch to multi-user (non-GUI) mode:</li>
    </ul>

<pre><code class="language-bash line-numbers">sudo systemctl isolate multi-user.target
</code></pre>

    <ul>
        <li>Switch to graphical mode (start GUI):</li>
    </ul>

<pre><code class="language-bash line-numbers">sudo systemctl isolate graphical.target
</code></pre>

    <ul>
        <li><b>Note:</b> <code>isolate</code> stops units not required by the new target.</li>
    </ul>
    <br/><br/>


    <li><b>Changing the Default Boot Target</b></li>
    <br/>
    <ul>
        <li>To permanently change what the system boots into:</li>
    </ul>

<pre><code class="language-bash line-numbers">sudo systemctl set-default multi-user.target
</code></pre>

<pre><code class="language-bash line-numbers">sudo systemctl set-default graphical.target
</code></pre>

    <ul>
        <li>This creates a symlink for <code>/etc/systemd/system/default.target</code>.</li>
        <li>Does <b>not</b> restart the system — only affects the next boot.</li>
    </ul>
    <br/><br/>


    <li><b>Rebooting, Powering Off, and Suspending</b></li>
    <br/>
    <ul>
        <li>systemd provides direct system state-changing commands:</li>
    </ul>

<pre><code class="language-bash line-numbers">sudo systemctl reboot       # Restart system
sudo systemctl poweroff     # Shut down
sudo systemctl halt         # Halt CPU (stop)
sudo systemctl suspend      # Sleep mode
sudo systemctl hibernate    # Hibernate
</code></pre>

    <ul>
        <li>These replace older commands like <code>shutdown -r now</code> and <code>halt</code>.</li>
    </ul>
    <br/><br/>


    <li><b>Recovery States (Rescue / Emergency)</b></li>
    <br/>
    <ul>
        <li>If something goes wrong, systemd provides minimal recovery targets.</li>

        <li><b>Rescue mode</b> — basic system with root shell:</li>
    </ul>

<pre><code class="language-bash line-numbers">sudo systemctl rescue
</code></pre>

    <ul>
        <li><b>Emergency mode</b> — minimal environment, no services, direct root shell:</li>
    </ul>

<pre><code class="language-bash line-numbers">sudo systemctl emergency
</code></pre>

    <ul>
        <li>Useful for repairing corrupted filesystems or broken configurations.</li>
    </ul>
    <br/><br/>


    <li><b>Showing a Target’s Dependencies</b></li>
    <br/>
    <ul>
        <li>You can inspect which units a target pulls in:</li>
    </ul>

<pre><code class="language-bash line-numbers">systemctl list-dependencies graphical.target
</code></pre>

    <ul>
        <li>This shows the entire boot chain visually (ASCII tree).</li>
    </ul>
    <br/><br/>
</ol>
<!-- * * * * * * * * * * * * * * -->


<hr/>


<!-- * * * * * * * * * * * * * * -->

<!-- * * * * * * * * * * * * * * -->


<hr/>
<!-- * * * * * * * * * * * * * * -->

<footer>
    <p>&copy; 2025 Hwangfucius. All rights reserved.</p>
</footer>
</body>
<!-- * * * * * * * * * * * * * * -->
</html>
<!-- * * * * * * * * * * * * * * -->
